- name: Announce playbook
  debug:
    msg: In debian.yml
- name: Configure automatic updates (unattended-upgrades)
  package:
    name: unattended-upgrades
    state: latest
- name: Configure automatic updates (20auto-upgrades)
  copy:
    dest: /etc/apt/apt.conf.d/20auto-upgrades
    content: |
      APT::Periodic::Update-Package-Lists "1";
      APT::Periodic::Download-Upgradeable-Packages "1";
      APT::Periodic::AutocleanInterval "7";
      APT::Periodic::Unattended-Upgrade "1";
- name: Disable SSH Password Authentication
  lineinfile:
    backup: yes
    path: /etc/ssh/sshd_config
    state: present
    line: 'PasswordAuthentication no'
    regexp: '^\#?PasswordAuthentication (yes|no)'
- name: Disable root logins
  lineinfile:
    backup: yes
    path: /etc/ssh/sshd_config
    state: present
    line: 'PermitRootLogin no'
    regexp: '^\#?PermitRootLogin (yes|no)'
- name: Install fail2ban
  package:
    name: fail2ban
    state: latest
- name: Create fail2ban config file (fail2ban.local)
  copy:
    src: /etc/fail2ban/fail2ban.conf
    dest: /etc/fail2ban/fail2ban.local
    force: no
- name: Create fail2ban config file (jail.local)
  copy:
    src: /etc/fail2ban/jail.conf
    dest: /etc/fail2ban/jail.local
    force: no
